# Сервис CallBack

1. Общее описание задачи

Задача:
На сайте устанавливается скрипт всплывающего модального окна, которое вступает в диалог с активными посетителями сайта и предлагает оставить номер телефона, гарантируя обратный звонок, например, за 29 секунд. Затем скрипт делает звонок и соединяет посетителя с менеджером компании.

Как это работает:
Клиент оставляет на сайте заявку.


Скрипт по IP-телефонии одновременно звонит на номер клиента и менеджеру компании. Все происходит полностью автоматически, и на эти действия уходит не более 29 секунд!

Если по какой-то причине первый оператор не отвечает или его номер уже занят, скрипт звонит на следующий номер. Если нет возможности соединиться и с ним – автоматически происходит набор третьего номера. И так далее, поочередно, до момента соединения.

Особенности скрипта:
Под скрипт разрабатывается онлайн кабинет менеджера компании для отслеживания статистики звонков, управления основными настройками и балансом. Авторизация выполняется по персональным логину и паролю. При регистрации автоматически создается ID клиента. Тарификация звонков производится с учетом нашей добавленной стоимости.


Основные настройки скрипта:
1. Адрес сайта, на который будет установлен скрипт.
2. Входящие звонки. Указываются номера телефонов для приема звонков от клиентов. Возможность ввести до 15 номеров.


Первое поле для определения типа телефона: обычный телефон, SIP;
Второе поле для определения страны;
Третье поле для ввода номера;
Четвертое поле для ввода добавочного номера;
Пятое поле выполняет активацию или деактивацию номера;
Шестое поле для ввода имени менеджера;
Седьмое поле для ввода названия отдела;
Восьмое поле для добавления номера;
Девятое поле для активации или деактивации функции, включающей имя менеджера в SMS сообщении отправляемом клиенту;
Девятое поле для активации или деактивации функции распределения звонков по отделам или филиалам.

3. SMS-информирование. Указываются номера телефонов для SMS-отчетов о качестве принятых звонков;
4. Email для уведомлений о непринятых входящих звонках;
5. Выбор часового пояса компании;
6. График работы отдела продаж с понедельника по воскресенье;
7. Задержка между звонками менеджеру и звонком клиенту (от 0 до 60 секунд);
8. Задержка перед набором добавочного номера (от 0 до 50 секунд);
9. Отображаемый входящий номер телефона: название скрипта, номер клиента;
10. Сценарий дозвона до менеджеров: поочередный, сразу всем;
11. Проговаривать голосом с какого сайта звонок (если больше 1 сайта);
12. Номера дозвона в случайном порядке (только для поочередного сценария);
13. Показывать в модальном окне выбор офисов. Если у компании более одного офиса, скрипт может предложить клиенту сделать выбор офиса для звонка;
14. Выбор кода страны, подставляемый в модальном окне по умолчанию;
15. Черный список номеров и IP адресов.
Статистика скрипта:
Входящие звонки от клиентов: за сегодня, вчера, неделю, месяц или произвольный период, а так же по каждому сайту в отдельности.

URL виджета, источник перехода, и ключевое слово (если из поиска);
Время звонка;
Номер клиента, заказавшего звонок;
Номер менеджера, принявшего звонок;
Длительность связи;
IP и регион клиента;
Статус звонка: 
– Звонок прошел успешно, 
– Менеджер не взял трубку, 
– Клиент не взял трубку.

Настройки виджета:
Виджет должен анализировать поведение посетителя, определять источник перехода и ключевой запрос. Так же виджет может автоматически подменять текст в зависимости от ключевого запроса.
Необходимо реализовать настраиваемую модель поведения виджета индивидуально для каждого сайта. На первом этапе разработки, по умолчанию, виджет всплывает только при желании посетителя покинуть сайт. Настройка должна быть гибкой, с возможностью расширения и внесения дополнений.
Сценарии, которые будем подключать в перспективе:
1. Ловить горячих.
Посетители, которые пришли на сайт из поисковика по горячему запросу;
Прямые заходы на сайт;
Посетители с высокой активностью на сайте в первые 60 сек.
Пример текста в окне виджета: Хотите, бесплатно перезвоним вам за 28 сек.? Мы поможем с поиском на сайте и ответим на все ваши вопросы!
2. Кто долго ищет.
Долго и активно изучает сайт, читает тексты, кликает по ссылкам, смотрит страницы.
Пример текста в окне виджета: Вы нашли, что искали на сайте? Хотите, перезвоним вам за 28 сек. и поможем с поиском?
3. Ловить на выходе.
Пример текста в окне виджета: Не нашли, что искали? Хотите, вам перезвоним за 28 сек.? Мы ответим на все вопросы и расскажем о текущих скидках!
Виджет должен быть показан посетителю всего один раз за сессию.
Разработать дополнительные настройки, позволяющие менять текст и внешний вид виджета: глобально, в зависимости от сценария или ключевого запроса (Мульти-виджет – автоматически подменяет текст и дизайн в окне виджета в зависимости от ключевого запроса посетителя).

2. Функционал

Телефония и программирование:
Для реализации задачи планируется использовать готовые инструменты МТТ.
У сервиса должен быть собственный сайт действующий от лица компании МТТ. В SMS-сообщениях, отчетах о платежах за выполнение услуг связи, а так же на виджете, должна быть указана информация об операторе связи МТТ.
Наше WEB API и сайт предпочтительно писать на языке программирования Python с помощью Django Framework. Язык стилей на сайте привести в порядок, используя динамичный CSS при помощи настройки LESS.
WEB API должен быть гибким, с возможностью расширения сервиса не прибегая к структурным изменениям модели.
WEB сайт:
Наш сервис должен иметь сайт с возможностью предоставления пользователям услуги CallBack по облачной технологии SaaS.

Необходимы инструменты для настройки прав доступа. По умолчанию в системе есть три типа пользователей: администратор, менеджер и зарегистрированный пользователь (далее «клиент сервиса»).
Администратор сервиса имеет доступ ко всем аккаунтам и их настройкам, управляет глобальными и персональными правами доступа к функционалу.
Менеджер сервиса имеет доступ ко всем аккаунтам и основным настройкам виджета, включая настройки дизайна и текстового содержания. Так же менеджер сервиса может управлять персональными правами доступа к закрытому администратором основному или дополнительному функционалу.
Клиент сервиса по умолчанию имеет доступ только к статистике, балансу и персональным настройкам аккаунта (id пользователя, email, пароль). Основные и дополнительные настройки виджета вносятся менеджером сервиса, который так же может при необходимости открыть их для клиента.

Билинг:
Сервис предоставляет услуги на условиях аренды. 
Есть возможность выбора срока оплаты: от 1 до 12 месяцев.
Первые 2 недели пользования сервисом предоставляются бесплатно. На этот период пользователь получает 100 рублей на балансе в подарок. Срок бесплатного использования и сумма баланса настраиваются админом сервиса.
Стоимость услуг связи (обратный звонок, SMS) пользователь оплачивает отдельно по установленному тарифу.
По истечении периода оплаты доступ к статистике и настройкам блокируется, виджет перестает воспроизводить сценарии и не выполяет моментальный обратный звонок. Но виджет не пропадает с сайта, а продолжает пассивную работу, которая заключается в информировании владельца сайта о заказанных звонках путем сообщения на email.
При отрицательном балансе виджет так же начинает работать в пассивном режиме, но доступ к интерфейсу (статистике и настройкам) сохраняется.
Личный кабинет пользователя имеет виртуальный счет, пополняемый при помощи билинга. После каждого звонка и отправленного SMS-сообщения с баланса списывается нужная сумма и автоматически зачисляется на счет МТТ. 
В случае, когда заканчивается срок аренды, а на счете имеется сумма большая месячной стоимости, то система автоматически спишет сумму равную одному месяцу аренды и продлит действие аккаунта.
Так же списание денежных средств может производиться автоматически со счета банковской карты пользователя. Добавление и удаление банковской карты, а так же подключение и отключение приема автоматической оплаты с банковской карты производится пользователем в личном кабинете.
Пополнить виртуальный счет можно любым способом, включая безналичный расчет для организаций.

Уведомления:
По умолчанию при каждом событии (пополнение и расход баланса, окончание периода аренды и т.д.) система информирует пользователя путем отправки сообщений на email.
Так же, пользователь самостоятельно может настроить этот параметр в личном кабинете: включать или отключать те или иные уведомления, указывать их периодичность.
Пользователь получает на свой email уведомления о:
Регистрации, смене пароля.
Снижении текущего баланса. 
По умолчанию уведомления активируются при балансе снижении баланса до 150 рублей. Далее система начинает ежедневно информировать пользователя о текущем балансе в плоть до блокировки аккаунта. Так же, пользователь может самостоятельно настроить этот параметр в личном кабинете.
Конец срока действия аренды.
По умолчанию система начинает ежедневно информировать пользователя о приближающемся сроке аренды за 7 дней до момента блокировки основного интерфейса пользователя. Данную настройку может поменять только администратор сервиса.
Пополнение баланса.
При успешном пополнении баланса пользователь получает соответствующее сообщение на email с информацией о дате, сумме и способе платежа. Данную настройку так же может поменять только администратор сервиса.
